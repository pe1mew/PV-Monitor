# Function description of PV monitor software

The PV monitor observes the 3 main parts of the PV installation:
- The Solar cells (PV)
- The battery (BATTERY)
- The load on the PV installation (LOAD)

## global objectives

- Measure energy generated by PV in Watt/hour
- Measure energy consumed/charged from BATTERY in Watt/hour
- Measure energy consumed by LOAD in Watt/hour.

## Objective details

- Report at a 15 minute interval for PV, BATTERY and LOAD:
 - Energy:
  - Maximum energy during the interval.
  - Minimum energy during the interval.
  - Total energy during the interval
 - Voltage:
  - Minimum PV voltage during the interval
  - Average PV voltage during the interval
  - Maximum PV voltage during the interval
  - Average battery voltage during the interval

## Optional

- Time that the PV is delivering energy.
- Time that the battery is charged
- Measure minimum energy of the PV during no sun periods. Determine the minimum power curve in a 60 minute interval. Use the "clouded curve" to determine the hours of sun. 

# Measurements

To measure power, Voltage and Current measurements shall be executed. Energy is the power per time interval, therefore measurements shall be executed over time.

# Theory, thoughts

**Kirchoff** Because of Kirchoffs first law the sum of currents shall be zero. This shall be "violated" by the power consumption by the PWM controller.

**Definitions**
Interval: time at which information is reported.
period: Time interval at which measurememts are executed.

**Math description**
Start reporting interval. (default is 15 minutes)
Measure current and voltage at a (1..10 second) interval and calculate the momentary energy.
Sum energy calculated with the prior recorded energies.
This method assumes no or very little variation in measurements.

At the end of period t power P is calculated by multiplying current and voltage. P = U x I.
P is than converted to watt per hour by multiplying with the period devided by 3600 seconds. P/h = P x t / 3600
The cummulative sum of all P/h per period is the energy over the reporting interval in watt/hour.

# Software design

C++ will be used.

Classes are required for:
- Measure current. 
 - Constuctor receives:
  - hardware pin of AD-port used to measure voltage representing current. 
  - resisitor R1 and R2 of the devider bridge.
 - getter returns actual current measurement in Amperes.
- Measure Voltage. 
 - Constructor receives:
  - hardware pin of AD-port used to measure voltage. 
  - resisitor R1 and R2 of the devider bridge.
 - getter returns actual voltage measurement in Volts.
- Store energy or voltage (for PV, BATTERY and LOAD) keeps track of minimum, average and maxium value. 
 - member variables:
  - count to keep track of the number of updates.
  - sum
  - minimum
  - average
  - maximum
 - Constructor receives:
  - interval in second at which measurements are executed
 - setter: adds energy and sums to total, updates min, max and average.
 - setter: reset all values
 - getter: gets total value (sum)
 - getter: get lowest value recorded.
 - getter: get highest value recorded.
 - getter: get average over period.